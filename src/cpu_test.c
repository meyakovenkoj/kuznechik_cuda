#include "kuznechik.h"
#include "cpu_kuznechik.h"
#include <stdio.h>

int main()
{
	uint8_t key[32] = {
		0x88, 0x99, 0xaa, 0xbb, 0xcc, 0xdd, 0xee, 0xff,
		0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77,
		0xfe, 0xdc, 0xba, 0x98, 0x76, 0x54, 0x32, 0x10,
		0x01, 0x23, 0x45, 0x67, 0x89, 0xab, 0xcd, 0xef
    };
	uint8_t rkey[160];
	uint8_t ls_matrix[256*16*16];
	uint8_t data[16] = {
		0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x00, 0xff, 0xee, 0xdd, 0xcc, 0xbb, 0xaa, 0x99, 0x88
	};
	uint8_t ethalon[16] = {
		0x7f, 0x67, 0x9d, 0x90, 0xbe, 0xbc, 0x24, 0x30, 0x5a, 0x46, 0x8d, 0x42, 0xb9, 0xd4, 0xed, 0xcd
	};

	create_ls_matrix(ls_matrix, key, rkey);
	for (int i = 0; i < 10; i++)
	{
		log_data(rkey + i * 16, "rkey");
	}
	gostencrypt(data, ls_matrix, rkey);
	log_data(data, "res");
	for (int i = 0; i < 16; i++) {
		if (data[i] != ethalon[i]) {
			log_data(data, "corrupted");
			log_data(ethalon, "corrupted");
			return 1;
		}
	}
	printf("all done\n");
	return 0;
}
